# http://www.atomicorp.com/
# Atomicorp (Gotroot.com) ModSecurity rules
# Application Security Rules for modsec 2.x
#
# Created by the Prometheus Group (http://www.prometheus-group.com)
# Copyright 2005-2008 by the Prometheus Group, all rights reserved.
# Redistribution is strictly prohibited in any form, including whole or in part.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS   
# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE   
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE   
# ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE   
# LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR   
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF   
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS   
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN   
# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)   
# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF   
# THE POSSIBILITY OF SUCH DAMAGE.
#

#--------------------------------
# notes
#--------------------------------
# Rules work with modsecurity 2.5 and above only
# rule ids 3400000's

#--------------------------------
#start rules
#--------------------------------

#Configure for your site
#SecDefaultAction "log,deny,auditlog,phase:2,status:403,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase"
SecDefaultAction "log,deny,auditlog,phase:2,status:403,t:lowercase,t:replaceNulls,t:compressWhitespace"


# Rule 340000: Enforce proper HTTP requests
# GET /robots.txt HTTP/1.0
SecRule REQUEST_PROTOCOL "!(?:^|\n|\r)(?:http|HTTP)/(0\.9|1\.[01])$" \
	"t:none,id:340000,rev:7,severity:1,msg:'Bad HTTP Protocol <%{TX.0}>'"

# Rule 34000X: Generic rule for allowed characters, very broken at the moment
# dont use it unless you can fix it
#SecRule REQUEST_URI "!^[-a-zA-z0-9\.\+_/\-\?\=]+$" "chain,id:340002,rev:1,severity:2,msg:'Restricted HTTP character set'"


# Rule 340001: Don't accept transfer encodings we know we don't handle
SecRule REQUEST_HEADERS:Transfer-Encoding "!^$" \
	"id:340001,rev:1,severity:2,msg:'Dis-allowed Transfer Encoding'"

# Rule 340002: deny TRACE method
SecRule REQUEST_METHOD "trac(?:e|k)" \
	"phase:1,t:lowercase,id:340002,rev:2,severity:2,msg:'TRACE/TRACK method denied'"

# Rule 340161: deny CONNECT method
SecRule REQUEST_METHOD "connect" \
	"phase:1,t:lowercase,id:340161,rev:1,severity:2,msg:'CONNECT method denied'"


# Rule 340003: XSS insertion into headers
SecRule REQUEST_HEADERS "(?:<[[:space:]]*(?:script|about|applet|activex|chrome)*>.*(?:script|about|applet|activex|chrome)[[:space:]]*>|onmouseover=|javascript\:)" \
	"id:340003,rev:2,severity:2,msg:'XSS attack in request'"


# Rule 340004: Don't accept chunked encodings
# modsecurity can not look at these, so this is a hole that can bypass your rules, 
# the rule before this oneshould cover this, but hey paranoia is cheap
SecRule REQUEST_HEADERS:Transfer-Encoding "chunked" \
	"id:340004,rev:1,severity:2,msg:'Chunked Transfer Encoding denied'"

# Rule 340005: Code injection via content length
SecRule REQUEST_HEADERS:Content-Length "\;(?:system|passthru|exec)\(" \
	"id:340005,rev:1,severity:2,msg:'Code Injection in Content-Length header'"

# Rule 340162
#SecRule REQUEST_HEADERS:Content-Length "!ˆ\d+$" \
# "id:340162,rev:1,severity:2,msg:’Content-Length HTTP header violation’"

# Rule 340006: generic recursion signatures
SecRule REQUEST_URI "!(?:alt_mod_frameset.php|checkout_shipping.php)" \
	"t:normalisePath,id:340006,rev:4,severity:2,msg:'Generic Path Recursion denied', chain"
SecRule REQUEST_URI "\.\./\.\./" 


# Rule 340007: generic recursion signatures
SecRule REQUEST_URI "\.\|\./\.\|\./\.\|" \
	"t:normalisePath,id:340007,rev:1,severity:2,msg:'Generic Path Recursion denied'"

# Rule 340008: generic bogus path sigs
SecRule REQUEST_URI "\.\.\./" \
	"id:340008,rev:1,severity:2,msg:'Bogus Path denied'"

# Rule 340009: 
#Generic PHP exploit signatures
SecRule REQUEST_BODY "(?:chr|fwrite|fopen|system|e?chr|passthru|popen|proc_open|shell_exec|exec|proc_nice|proc_terminate|proc_get_status|proc_close|pfsockopen|leak|apache_child_terminate|posix_kill|posix_mkfifo|posix_setpgid|posix_setsid|posix_setuid|phpinfo)\(.*\)\;" \
	"id:340009,rev:1,severity:2,msg:'Generic PHP exploit pattern denied'"

# Rule 340010: 
#Generic PHP exploit signatures
SecRule REQUEST_BODY|REQUEST_URI "<\?php (?:chr|fwrite|fopen|system|echr|passthru|popen|proc_open|shell_exec|exec|proc_nice|proc_terminate|proc_get_status|proc_close|pfsockopen|leak|apache_child_terminate|posix_kill|posix_mkfifo|posix_setpgid|posix_setsid|posix_setuid|phpinfo)\(.*\)\;" \
	"id:340010,rev:1,severity:2,msg:'Generic PHP exploit pattern denied'"

# Rule 340011: 
#slightly tighter rules with narrower focus
SecRule REQUEST_URI|REQUEST_BODY "(?:chr|fwrite|fopen|system|echr|passthru|popen|proc_open|shell_exec|exec|proc_nice|proc_terminate|proc_get_status|proc_close|pfsockopen|leak|apache_child_terminate|posix_kill|posix_mkfifo|posix_setpgid|posix_setsid|posix_setuid|phpinfo)\(.*\)\;" \
	"id:340011,rev:1,severity:2,msg:'Generic PHP exploit pattern denied'"

# Rule 340012: 
#generic XSS PHP attack types
SecRule REQUEST_URI "\.php\?" \
	"chain,id:340012,rev:1,severity:2,msg:'Generic PHP XSS exploit pattern denied'"
SecRule REQUEST_BODY|REQUEST_URI  "(?:javascript\:/(?:.*new\x20ActiveXObject.*Sh\.regwrite|.*window\.opener\.document\.body.\innerHTML=window\.opener\.document\.body\.innerHTML\.replace)|onmouseover=\'javascript)"


# Rule 340013: 
#Prevent SQL injection in cookies
SecRule REQUEST_COOKIES "(?:(?:select|grant|delete|insert|drop|alter|replace|truncate|update|create|rename|describe)[[:space:]]+[A-Z|a-z|0-9|\*| |\,]+[[:space:]]+(?:from|into|table|database|index|view)[[:space:]]+[A-Z|a-z|0-9|\*| |\,]|UNION SELECT.*\'.*\'.*,[0-9].*INTO.*FROM)" \
	"id:340013,rev:1,severity:2,msg:'Generic SQL injection in cookie'"

# Rule 340014: 
#Prevent command injection through cookies
SecRule REQUEST_COOKIES "\; cmd=" \
	"id:340014,rev:1,severity:2,msg:'CMD injection'"

# Rule 340015: 
#Prevent SQL injection in UA
SecRule REQUEST_HEADERS:User-Agent "(?:(?:select|grant|delete|insert|drop|alter|replace|truncate|update|create|rename|describe)[[:space:]]+[A-Z|a-z|0-9|\*| |\,]+[[:space:]]+(?:from|into|table|database|index|view)[[:space:]]+[A-Z|a-z|0-9|\*| |\,]|UNION SELECT.*\'.*\'.*,[0-9].*INTO.*FROM)"\
	 "id:340015,rev:1,severity:2,msg:'Generic SQL injection in User Agent header'"

# Rule 340016: 
# Generic filter to prevent SQL injection attacks
# Understand that all SQL filters are very limited and are very difficult 
# to prevent false postives and negatives.  
# Pplease report false positives/negatives to mike@gotroot.com
SecRule REQUEST_URI "!(?:(?:/wp-admin/post|privmsg|/ticket/admin|/misc|tiki-editpage|/post|/horde3?/imp/compose|/posting)\.php|/modules\.php\?op=modload&name=(?:Downloads|Submit_News)|/admin\.php\?module=NS\-AddStory\&op=|/index\.php\?name=PNphpBB2&file=posting&mode=reply.*|/phpMyAdmin/|/PNphpBB2-posting\.html|/otrs/index\.pl|tiki-index\.php\?page=|/index\.php\?title=.*&action=edit|/_mmServerScripts/|/node/[0-9]+/edit|/_vti_bin/.*\.exe/)" \
	"chain,id:340016,rev:2,severity:2,msg:'Generic SQL injection protection'"
SecRule REQUEST_URI|REQUEST_BODY "(?:(?:select|grant|delete|insert|drop|alter|replace|truncate|update|create|rename|describe)[[:space:]]+[A-Z|a-z|0-9|\*| |\,]+[[:space:]]+(?:from|into|table|database|index|view)[[:space:]]+[A-Z|a-z|0-9|\*| |\,]|UNION SELECT.*\'.*\'.*,[0-9].*INTO.*FROM)"  


# Rule 340017: 
#Generic SQL sigs
# 
SecRule REQUEST_URI "!(?:^/edit_page$|/node/[0-9]+/edit|^/forum/posting\.php|^/admins/wnedit\.php|/alt_doc\.php\?returnUrl=.*edit|^/admin/categories\.php\?cPath=.*|modules\.php\?name=Forums&file=posting&mode=.*|^/joomla/administrator/index2\.php|^/wiki/index\.php?.*action=submit|^/imp/compose\.php|^/horde/imp/compose\.php|ubbthreads\.php|/sql.php|/tbl_(?:change|sql)\.php|/admincp/template\.php\?do=(?:insert|update)template|admin/area/save-page\.php$|^/cgi-bin/cookmail\.exe$|^/catalog/secure_admin/categories\.php\?cPath=)" \
	"chain,id:340017,rev:32,severity:2,msg:'Generic SQL injection protection'"
SecRule ARGS|!ARGS:text|!ARGS:edited|!ARGS:content|!ARGS:description|!ARGS:introtext|!ARGS:Post|!ARGS:sql_query|!ARGS:itembigtext|!ARGS:article_content|!ARGS:body|!ARGS:myTextArea|!ARGS:ll_content_message|!ARGS:page-content|!ARGS:reply|!ARGS:xml|!ARGS:content_en|!ARGS:filecontent|!ARGS:message|!ARGS:content_en|!ARGS:general[description] "(?:insert[[:space:]]+into.+values|select\s+from.+[a-z|A-Z|0-9]|bulk[[:space:]]+insert|union.+select|convert.+\(.*from)" 

# Rule 340018: 
#Generic command line attack filter
SecRule REQUEST_URI "!(?:/count\.cgi|^/magento/index\.php/admin/dashboard/)" \
	"chain,id:340018,rev:3,severity:2,msg:'Generic command line attack filter'"
SecRule REQUEST_URI|REQUEST_BODY|!ARGS:site_first "\|+.*[\x20].*[\x20].*\|"

# Rule 340019: 
#Generic PHP bad functions protection
#PHP copy() function: http://securitytracker.com/alerts/2006/Apr/1015882.html
SecRule ARGS "compress\.zlib:" \
	"id:340019,rev:1,severity:2,msg:'Generic PHP bad functions protection'"

# Rule 340020: 
#XSS in referrer and UA headers
SecRule REQUEST_HEADERS:REFERER|REQUEST_URI "!(?:/plugins/editors/tinymce/jscripts/|/modules/tinymce/tinymce/jscripts|/phpinfo_iframe\.php)" \
        "id:340020,t:replaceNulls,t:htmlEntityDecode,t:urlDecodeUni,t:compressWhiteSpace,t:lowercase,rev:11,severity:2,msg:'XSS in referrer and UA headers',chain"  
SecRule REQUEST_HEADERS:REFERER "!(^pagead[0-9]\.googlesyndication\.com/pagead/|/gills\.swf?txt=<a href= ?asfunction:_root\.launchURL|vbscript.*convert.*&hl=.*client=|convert.*vbscript.*Search)" chain
SecRule REQUEST_HEADERS:REFERER|REQUEST_HEADERS:User-Agent "(?:<[[:space:]]*(?:script|about|applet|activex|chrome).*(?:script|about|applet|activex|chrome)[[:space:]]*>|activexobject|(?:\.add|\@)import|asfunction\:|background-image\:|e(?:cma|xec)script|\.fromcharcode|get(?:parentfolder|specialfolder)|iframe |\.innerhtml|\<input|(?:java|live|j)script!s|lowsrc|mocha\:|on(?:abort|blur|change|click|dragdrop|focus|keydown|keypress|keyup|load)|on(?:mouse(?:down|move|out|over|up)|(?:move|resize|select|submit|unload))|script |settimeout|shell\:|(?:vb|x-java)script)" 

# Rule 340021: PHP Injection Attack generic signature
SecRule REQUEST_URI  "(!/lightboxjs\.php\?path=http:/)" \
	"t:lowercase,t:replaceNulls,t:compressWhitespace,t:normalisePath,chain,id:340021,rev:2,severity:2,msg:'PHP Injection Attack 1'"
SecRule REQUEST_URI  "\.php" chain
SecRule REQUEST_URI|REQUEST_BODY "(?:\?(?:(?:LOCAL|INCLUDE|PEAR|SQUIZLIB)_PATH|action|content|dir|name|menu|pm_path|path|pathtoroot|cat|pagina|path|include_location|root|page|gorumDir|site|topside|pun_root|open|seite)=(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/|(?:cmd|command)=(?:cd|\;|perl |killall |python |rpm |yum |apt-get |emerge |lynx |links |mkdir |elinks |id|cmd|pwd|wget |lwp-(?:download|request|mirror|rget) |uname|cvs |svn |(?:s|r)(?:cp|sh) |net(?:stat|cat) |rexec |smbclient |t?ftp |ncftp |curl |telnet |gcc |cc |g\+\+ |\./|whoami|killall |rm \-[a-z|A-Z]))" 


# Rule 340022: PHP Injection Attack generic signature
SecRule REQUEST_URI  "\.php\?(?:(?:(?:LOCAL|INCLUDE|PEAR|SQUIZLIB)_PATH|action|content|dir|name|menu|pm_path|pagina|path|pathtoroot|cat|include_location|gorumDir|root|page|site|topside|pun_root|open|seite)=(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/|.*(?:cmd|command)=(?:cd|\;|perl |killall |python |rpm |yum |apt-get |emerge |lynx |links |mkdir |elinks |cmd|pwd|wget |lwp-(?:download|request|mirror|rget) |id|uname |cvs |svn |(?:s|r)(?:cp|sh) |net(?:stat|cat)|rexec |smbclient |t?ftp |ncftp |curl |telnet |gcc |cc |g\+\+ |whoami|\./|killall |rm \-[a-z|A-Z]))" \
	"id:340022,rev:1,severity:2,msg:'PHP Injection Attack 2'"


# Rule 340023: Generic PHP remote file inclusion attack signature
SecRule REQUEST_URI "\.php\?" \
	"chain,id:340023,rev:1,severity:2,msg:'PHP remote file inclusion'"
SecRule REQUEST_URI "(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/" chain
SecRule REQUEST_URI|REQUEST_BODY "(?:cmd|command)=(?:cd|\;|perl |killall |python |rpm |yum |apt-get |emerge |lynx |links |mkdir |elinks |cmd|pwd|wget |lwp-(?:download|request|mirror|rget) |id|uname|cvs |svn |(?:s|r)(?:cp|sh) |net(?:stat|cat) |rexec |smbclient |t?ftp |ncftp |curl |telnet |gcc |cc |g\+\+ |whoami|\./|killall |rm \-[a-z|A-Z])" 


# Rule 340024: Generic PHP remote file inclusion attack signature with command
SecRule REQUEST_URI "\.php\?" \
	"chain,id:340024,rev:1,severity:2,msg:'PHP remote include with command'"
SecRule REQUEST_URI "(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/" chain
SecRule REQUEST_URI|REQUEST_BODY "(?:cmd|command)=.*(?:cd|\;|perl |killall |python |rpm |yum |apt-get |emerge |lynx |links |mkdir |elinks |cmd|pwd|wget |lwp-(?:download|request|mirror|rget) |id|uname|cvs |svn |(?:s|r)(?:cp|sh) |net(?:stat|cat) |rexec |smbclient |t?ftp |ncftp |curl |telnet |gcc |cc |g\+\+ |whoami|\./|killall |rm \-[a-z|A-Z])" 


# Rule 340025: Really broad furl_fopen attack sig (LEGACY RULE)
#SecRule REQUEST_URI "!(?:/imp/compose\.php|/tiki-(?:objectpermissions|editpage)|/cowadmin/editor/.*/editor|index\.php\?url=|aardvarkts/install/index|/do_command|banner_click|wp-login|tiki-view_cache|/horde/index|/horde/services/go|/goto|gallery2?/main|ad-?server/adjs|signup\.php|calendar/index\.php\?act=calendar&code=edit&cal_id=.*&event_id=)" \
#                "id:340025,rev:10,severity:2,msg:'PHP Injection attempt in URI',chain"
#SecRule ARGS|!ARGS:url|!ARGS:base_url|!ARGS:outbound|!ARGS:out|!ARGS:referer|!ARGS:serverurl|!ARGS:referrer|!ARGS:team[logo]|!ARGS:team[url]|!ARGS:helpurl|!ARGS:helpbox|!ARGS:website|!ARGS:return "(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/"

# Rule 340026: Generic PHP code injection protection in URI
SecRule REQUEST_FILENAME|REQUEST_URI "!(?:^/signup\.php|^/go\.php\?u=affilorama&t=http://|^/cgi-bin/mirror_xml\.php\?bg_image=http://|^/frame\.php\?ref=&from=http://.*&url=.*/$|^/spam/gethref\.php\?img=http://)" \
	"chain,id:340026,rev:19,severity:2,msg:'PHP Injection attempt in URI'"
SecRule REQUEST_URI "(?:\.php(?:3|4|5)?(?:\?|&)|^/(?:\?|&)).*=(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/" chain
SecRule REQUEST_URI "!(?:/imp/compose\.php|/tiki-(?:objectpermissions|editpage)|/cowadmin/editor/.*/editor|index\.php\?url=|aardvarkts/install/index|/do_command|banner_click|wp-login|tiki-view_cache|/horde/index|/horde/services/go|/goto|gallery2?/main|ad-?server/adjs|signup\.php|calendar/index\.php\?act=calendar&code=edit&cal_id=.*&event_id=)" chain
#SecRule ARGS "!@pmFromFile trusted-domains.conf" chain
SecRule ARGS|!ARGS:url|!ARGS:base_url|!ARGS:outbound|!ARGS:out|!ARGS:referer|!ARGS:serverurl|!ARGS:referrer|!ARGS:team[logo]|!ARGS:team[url]|!ARGS:helpurl|!ARGS:helpbox|!ARGS:website|!ARGS:return|!ARGS:ureferrer|!ARGS:refertoyouby|!ARGS:ajaxurl|!ARGS:redirect|!ARGS:product[media_gallery][images]|!ARGS:loc|!ARGS:backurl|!ARGS:r_uri|!ARGS:oaparams "(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/"

# Rule 340027: Genenric PHP body attack
SecRule REQUEST_BODY "(?:chr|fwrite|fopen|system|echr|passthru|popen|proc_open|shell_exec|exec|proc_nice|proc_terminate|proc_get_status|proc_close|pfsockopen|leak|apache_child_terminate|posix_kill|posix_mkfifo|posix_setpgid|posix_setsid|posix_setuid|phpinfo)" \
	"chain,id:340027,rev:1,severity:2,msg:'Generic XSS filter'"
SecRule REQUEST_BODY "^PHP\:*(?:(?:cd|mkdir)[[:space:]]+(?:/|[A-Z|a-z|0-9]|\.)*|perl |killall |python |rpm |yum |apt-get |emerge |lynx |links |mkdir |elinks |cmd|pwd|wget |lwp-(?:download|request|mirror|rget) |id|uname |cvs |svn |(?:s|r)(?:cp|sh) |net(?:stat|cat)|rexec |smbclient |t?ftp |ncftp |chmod |curl |telnet |gcc |cc |g\+\+ |whoami|\./|killall |rm \-[a-z|A-Z])" 


# Rule 340028: Generic PHP remote file injection
SecRule REQUEST_URI "!(?:/do_command)" \
	"chain,id:340028,rev:2,severity:2,msg:'PHP remote file injection'"
SecRule REQUEST_URI "\.php\?.*=(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/.*(?:cmd|command)=" 


# Rule 340029: script, perl, etc. code in REQUEST_HEADERS:Referer string
SecRule REQUEST_HEADERS:Referer "\#\!.*/" \
	"id:340029,rev:1,severity:2,msg:'Command in Referer string'"


# Rule 340030: generic command line attack
SecRule REQUEST_URI|ARGS "\|*id\;echo*\|" \
	"id:340030,rev:1,severity:2,msg:'Command line attack'"


# Rule 340031: remote file inclusion generic attack signature
SecRule REQUEST_URI  "\.(?:dat|gif|jpg|png|bmp|txt|vir|dot)\?" \
	"chain,id:340031,rev:1,severity:2,msg:'Remote file inclusion'"
SecRule REQUEST_URI|REQUEST_BODY "(?:(?:name|pm_path|pagina|path|include_location|root|page|open)=(?:ogg|gopher|zlib|(?:ht|f)tps?)|(?:cmd|command|inc)=)" 



# Rule 340032: remote file inclusion generic attack signature
SecRule ARGS  "\.(?:dat|gif|jpg|png|bmp|txt|vir|dot)" \
	"chain,id:340032,rev:1,severity:2,msg:'Remote file inclusion'"
SecRule ARGS "\?\&(?:cmd|inc|name)=" 

# Rule 340033: remote file inclusion generic attack signature
SecRule ARGS  "\.(?:dat|gif|jpg|png|bmp|txt|vir|dot)\?\&(?:cmd|inc|name)=" \
	"id:340033,rev:1,severity:2,msg:'Remote file inclusion'"


# Rule 340035: Bogus file extensions generic signature
SecRule REQUEST_URI  "[A-Za-z0-9]\.(?:gif|jpg|png|bmp)\.(?:txt|dat)" \
	"id:340035,rev:2,severity:2,msg:'Bogus file extensions'"

# Rule 340036: PHP remote path attach generic signature
SecRule REQUEST_URI "!(?:/cowadmin/editor/.*/editor)" \
	"id:340036,rev:3,severity:2,msg:'PHP Remote path attack',chain"
SecRule REQUEST_URI  "\.ph(?:p(?:3|4)?).*path=(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/" 


# Rule 340037: generic attack sig
SecRule REQUEST_URI "cd\x20*\;(?:cd|\;|echo|perl |killall |python |rpm |yum |apt-get |emerge |lynx |links |mkdir |elinks |cmd|pwd|wget |lwp-(?:download|request|mirror|rget) |id|uname |cvs |svn |(?:s|r)(?:cp|sh) |net(?:stat|cat) |rexec |smbclient |t?ftp |ncftp |curl |telnet |gcc |cc |g\+\+ |\./)" \
	"id:340037,rev:1,severity:2,msg:'Generic command injection'"

# Rule 340038: WEB-ATTACKS uname -a command attempt
SecRule REQUEST_URI "uname" \
	"chain,id:340038,rev:1,severity:2,msg:'uname -a command attempt'"
SecRule REQUEST_URI "\x20-a" 

# Rule 3400XX: Generic argument protection rule against bad meta characters
#SecRule "ARGS" "!^[A-Za-z0-9.&/?@_%=:;, -]*$"

# Rule 340039: generic php attack sigs
SecRule REQUEST_URI "(?:&(?:cmd|command)=(?:id|uname)\x20|cmd\?(?:cmd|command)=|(?:spy|cmd|cmd_out|sh)\.(?:gif|jpg|png|bmp|txt)\?&(?:cmd|command)=|\.php\?&(?:cmd|command)=)" \
	"id:340039,rev:1,severity:2,msg:'PHP command injection attempt'"


# Rule 340040: WEB-ATTACKS xterm command attempt
SecRule REQUEST_URI "/usr/X11R6/bin/xterm|/usr/xorg/bin/xterm" \
	"id:340040,rev:1,severity:2,msg:'Xterm exection attempt'"

# Rule 340041: WEB-ATTACKS /etc/shadow access
SecRule REQUEST_URI "/etc/shadow"\
	"id:340041,rev:1,severity:2,msg:'/etc/shadow read attempt'"

# Rule 340042: WEB-ATTACKS /bin/ps command attempt
SecRule REQUEST_URI "/bin/ps" \
	"id:340042,rev:1,severity:2,msg:'Command attempt (ps)'"

# Rule 340043: WEB-ATTACKS /usr/bin/id command attempt
SecRule REQUEST_URI  "/usr/bin/id" \
	"chain,id:340043,rev:1,severity:2,msg:'Command attempt (id)'"
SecRule REQUEST_URI "\x20"  

# Rule 340044: WEB-ATTACKS echo command attempt
SecRule REQUEST_URI  "/bin/echo" \
	"chain,id:340044,rev:1,severity:2,msg:'Command attempt (echo)'"
SecRule REQUEST_URI "\x20" 

# Rule 340045: WEB-ATTACKS kill command attempt
SecRule REQUEST_URI  "/bin/kill" \
	"chain,id:340045,rev:1,severity:2,msg:'Command attempt (kill)'"
SecRule REQUEST_URI "\x20" 


# Rule 340046: WEB-ATTACKS chmod command attempt
SecRule REQUEST_URI  "/bin/chmod" \
	"chain,id:340046,rev:1,severity:2,msg:'Command attempt (chmod)'"
SecRule REQUEST_URI "\x20" 

# Rule 340047: WEB-ATTACKS chsh command attempt
SecRule REQUEST_URI   "/usr/bin/chsh" \
	"id:340047,rev:1,severity:2,msg:'Command attempt (chsh)'"


# Rule 340048: WEB-ATTACKS gcc command attempt
SecRule REQUEST_URI  "gcc" \
	"chain,id:340048,rev:1,severity:2,msg:'Command attempt (gcc)'"
SecRule REQUEST_URI "x20-o" 


# Rule 340049: WEB-ATTACKS /usr/bin/cc command attempt
SecRule REQUEST_URI  "/usr/bin/cc" \
	"chain,id:340049,rev:1,severity:2,msg:'Command attempt (cc)'"
SecRule REQUEST_URI "\x20" 



# Rule 340050: WEB-ATTACKS /usr/bin/cpp command attempt
SecRule REQUEST_URI  "/usr/bin/cpp" \
	"chain,id:340050,rev:1,severity:2,msg:'Command attempt (cpp)'"
SecRule REQUEST_URI "\x20" 



# Rule 340051: WEB-ATTACKS /usr/bin/g++ command attempt
SecRule REQUEST_URI  "/usr/bin/g\+\+" \
	"chain,id:340051,rev:1,severity:2,msg:'Command attempt (g++)'"
SecRule REQUEST_URI "\x20" 



# Rule 340052: WEB-ATTACKS g++ command attempt
SecRule REQUEST_URI  "g\+\+\x20" \
	"chain,id:340052,rev:1,severity:2,msg:'Command attempt (g++)'"
SecRule REQUEST_URI "\x20" 




# Rule 340053: WEB-ATTACKS bin/python access attempt
SecRule REQUEST_URI  "bin/python" \
	"chain,id:340053,rev:1,severity:2,msg:'Command attempt (python)'"
SecRule REQUEST_URI "\x20" 


# Rule 3400XX: WEB-ATTACKS python access attempt
#SecRule "python\x20"

# Rule 340054: WEB-ATTACKS bin/tclsh execution attempt
SecRule REQUEST_URI "bin/tclsh" \
	"id:340054,rev:1,severity:2,msg:'Command attempt (tclsh)'"


# Rule 340055: WEB-ATTACKS tclsh execution attempt
SecRule REQUEST_URI "tclsh8\x20" \
	"id:340055,rev:1,severity:2,msg:'Command attempt (tclsh8)'"



# Rule 340056: WEB-ATTACKS bin/nasm command attempt
SecRule REQUEST_URI "bin/nasm" \
	"id:340056,rev:1,severity:2,msg:'Command attempt (nasm)'"



# Rule 340057: WEB-ATTACKS nasm command attempt
SecRule REQUEST_URI "nasm\x20" \
	"id:340057,rev:1,severity:2,msg:'Command attempt (nasm)'"



# Rule 340058: WEB-ATTACKS /usr/bin/perl execution attempt
SecRule REQUEST_URI "/usr/bin/perl" \
	"id:340058,rev:1,severity:2,msg:'Command attempt (perl)'"



# Rule 340059: WEB-ATTACKS traceroute command attempt
SecRule REQUEST_URI  "traceroute" \
	"chain,id:340059,rev:1,severity:2,msg:'Command attempt (traceroute)'"
SecRule REQUEST_URI "\x20(?:[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}|[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)" 


# Rule 340060: WEB-ATTACKS ping command attempt
SecRule REQUEST_URI  "/bin/ping" \
	"chain,id:340060,rev:1,severity:2,msg:'Command attempt (ping)'"
SecRule REQUEST_URI "\x20"  


# Rule 340061: WEB-ATTACKS X application to remote host attempt
SecRule REQUEST_URI "\x20-display\x20" \
	"id:340061,rev:1,severity:2,msg:'Command attempt (xterm -display)'"



# Rule 340062: WEB-ATTACKS mail command attempt
SecRule REQUEST_URI  "/bin/mail" \
	"chain,id:340062,rev:1,severity:2,msg:'Command attempt (mail)'"
SecRule REQUEST_URI "\x20"  


# Rule 340063: WEB-ATTACKS /bin/ls command attempt
SecRule REQUEST_URI "/bin/ls" \
	"chain,id:340063,rev:1,severity:2,msg:'Command attempt (ls)'"
SecRule REQUEST_URI "\x20"  


# Rule 340064: WEB-ATTACKS /etc/inetd.conf access
SecRule REQUEST_URI  "(?:/etc/inetd\.conf|/etc/xinetd)" \
	"id:340064,rev:2,severity:2,msg:'Access attempt (xinetd/inetd)'"



# Rule 340065: WEB-ATTACKS /etc/motd access
SecRule REQUEST_URI  "/etc/motd" \
	"id:340065,rev:1,severity:2,msg:'Access attempt (motd)'"


# Rule 340066: WEB-ATTACKS conf/httpd.conf attempt
SecRule REQUEST_URI  "conf/httpd\.conf" \
	"id:340066,rev:1,severity:2,msg:'Access attempt (httpd.conf)'"



# Rule 340067:  WEB-MISC .htpasswd access
#SecRule REQUEST_URI  "\.htpasswd" \
SecRule REQUEST_URI  "(?:!^/amember/admin/setup\.php\?notebook=)"  chain
SecRule REQUEST_URI  "\.htpasswd" \
	"id:340067,rev:2,severity:2,msg:'Direct access attempt (htpasswd)'"



# Rule 340068: WEB-MISC /etc/passwd access
SecRule REQUEST_URI  "/etc/passwd"  \
	"id:340068,rev:1,severity:2,msg:'Access attempt (/etc/passwd)'"



# Rule 340069: WEB-MISC nessus 1.X 404 probe
SecRule REQUEST_URI "/nessus_is_probing_you_"  \
	"id:340069,rev:1,severity:2,msg:'Nessus scan'"



# Rule 340070: WEB-MISC nessus 2.x 404 probe
SecRule REQUEST_URI "/NessusTest" \
	"id:340070,rev:1,severity:2,msg:'Nessus scan'"



# Rule 340071: WEB-MISC ls%20-l
SecRule REQUEST_URI  "ls -l"  \
	"id:340071,rev:2,severity:2,msg:'Command attempt (ls -l)'"


# Rule 340072: WEB-MISC apache directory disclosure attempt
SecRule REQUEST_URI "////////"  \
	"id:340072,rev:1,severity:2,msg:'Directory disclosure'"



# Rule 340073: musicat empower attempt
SecRule REQUEST_URI "/empower\?DB=" \
	"id:340073,rev:1,severity:2,msg:'Empower attempt'"



# Rule 340074: WEB-MISC *%0a.pl access
SecRule REQUEST_URI "/*\x0a\.pl"  \
	"id:340074,rev:1,severity:2,msg:'*%0a.pl access attempt'"



# Rule 340075: PHPBB worm sigs
SecRule REQUEST_URI "!(?:tiki-searchindex\.php)" \
	"chain,id:340075,rev:1,severity:2,msg:'PHPBB worm'"
SecRule ARGS:highlight "(?:\x27|%27|\x2527|%2527)" 


# Rule 340076: PHP defenses
SecRule ARGS:PHPSESSID "!^[0-9a-z]*$"  \
	"id:340076,rev:1,severity:2,msg:'PHP Session attack'"



# Rule 340077: PHP defenses
SecRule ARGS|!ARGS:operate|!ARGS:search_keywords "^(?:globals(?:$|\[)|php:/)" \
	"id:340077,rev:4,severity:2,msg:'PHP policy violation'"



# Rule 340078: PHP defenses
SecRule REQUEST_COOKIES:PHPSESSID "!^[0-9a-z]*$" \
	"id:340078,rev:1,severity:2,msg:'PHP cookie policy violation'"



# Rule 340079: PHP defenses
SecRule REQUEST_COOKIES:sessionid "![0-9a-z]*$" \
	"id:340079,rev:10,severity:2,msg:'PHP policy violation'"



# Rule 340080: Web-attacks chdir
SecRule REQUEST_URI "&(?:cmd|command)=chdir\x20" \
	"id:340080,rev:1,severity:2,msg:'Command attempt (chdir)'"



# Rule 340081: TIKIWIKI
SecRule REQUEST_URI  "/tiki-map.phtml\?mapfile=\.\./\.\./" \
	"id:340081,rev:1,severity:2,msg:'TikiWiki directory traversal'"



# Rule 340082: SMTP redirects
SecRule REQUEST_URI_RAW "^(?:(?:ht|f)tps?|connect)\:/.+:25"  \
	"id:340082,rev:2,severity:2,msg:'SMTP redirect over http attempt'"


# Rule 340083: very experimental generic remote download sig
# These are VERY experiemental, please report false positives/negatives, etc.
# foo IP or FQDN, or foo http/https/ftp://whatever
SecRule REQUEST_URI "(?:perl|t?ftp|links|elinks|lynx|ncftp|(?:s|r)(?:cp|sh)|wget|lwp-(?:download|request|mirror|rget)|curl|cvs|svn).*\x20(?:(?:ogg|gopger|zlib|(?:ht|f)tps?)\:/|[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}|.*[A-Za-z|0-9]\.[a-zA-Z]{2,4}/|[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)"  \
	"id:340083,rev:1,severity:2,msg:'Generic Command attempt'"




# Rule 340084: Command inline detection
SecRule  REQUEST_URI "!(?:/scp/tickets\.php)" \
	"chain,id:340084,rev:2,severity:2,msg:'Command injection attempt'"
SecRule REQUEST_URI "(?: |\;|/|\'|,|\&|\=|\.)(?:(?:s|r)(?:sh|cp)) *(?:.*\@.*|(?:ogg|gopger|zlib|(?:ht|f)tps?)\:/|[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}|.*[A-Za-z|0-9]\.[a-zA-Z]{2,4}/|[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)" 


# Rule 340085: very experimental connect command sig
SecRule REQUEST_URI "(?: |\;|/|\'|,|\&|\=|\.)(?:perl|nc|telnet|(?:rs)sh|rexec) .*(?:[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}|[A-Za-z|0-9]\.[a-zA-Z]{2,4}|[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)" \
	"id:340085,rev:1,severity:2,msg:'Command injection attempt'"


# Rule 340086: Commands, also need a major rework, these also have issues
SecRule REQUEST_URI "\;\x20+?perl\x20+[A-Za-z|0-9]+;" \
	"id:340086,rev:1,severity:2,msg:'Command attempt (perl)'"

# Rule 340087: SecRule REQUEST_URI "echo\x20" 
SecRule REQUEST_URI "(?:lynx|curl|wget|links) -dump " \
	"id:340087,rev:1,severity:2,msg:'Command attempt (links)'"

# Rule 340088: Command attempt (links)
SecRule REQUEST_URI "links (?:-(?:dump-(?:charset|width)|source)|(?:ht|f)tps?\:/)" \
	"id:340088,rev:1,severity:2,msg:'Command attempt (links)'"

# Rule 340089: Command attempt (links)
SecRule REQUEST_URI "links (?:ogg|gopger|zlib|(?:ht|f)tps?)\:/" \
	"id:340089,rev:1,severity:2,msg:'Command attempt (links)'"

# Rule 340091: cd to tmp 
#SecRule REQUEST_URI "mkdir\x20" 
SecRule REQUEST_URI "cd\x20/(?:tmp|/var/tmp)"  \
	"id:340091,rev:1,severity:2,msg:'Command attempt (cd tmp)'"


# Rule 340092: cd .. attempt
SecRule REQUEST_URI "cd \.\."  \
	"id:340092,rev:1,severity:2,msg:'Command attempt (cd ..)'"

# Rule 340093: Access bash_history
SecRule REQUEST_URI "/\.(?:history|bash_history) HTTP\/(?:0\.9|1\.0|1\.1)$"  \
	"id:340093,rev:1,severity:2,msg:'Access attempt (.history/.bash_history)'"


# Rule 340094: generic block for fwrite fopen uploads
SecRule REQUEST_URI "fwrite" \
	"chain,id:340094,rev:1,severity:2,msg:'PHP fwrite/fopen attempt'"
SecRule REQUEST_URI "fopen" 


# Rule 340095: generic sig for more bad PHP functions
SecRule REQUEST_URI "chr\(?:(?:[0-9]{1,3})\)" \
	"id:340095,rev:1,severity:2,msg:'PHP policy violation (chr)'"

# Rule 340096: PHP policy violation
SecRule ARGS_NAMES "^php:/" \
	"id:340096,rev:1,severity:2,msg:'PHP policy viloation'"


# Rule 340097:  WEB-MISC Tomcat view source attempt
SecRule REQUEST_URI "\x252ejsp" \
	"id:340097,rev:1,severity:2,msg:'Tomcat view source attempt'"


# Rule 3400XX:  WEB-MISC whisker HEAD/./
#SecRule "HEAD/./"

# Rule 340098: WEB-FRONTPAGE .... request
SecRule REQUEST_URI "\.\.\.\./" \
	"id:340098,rev:1,severity:2,msg:'FRONTPAGE .... request'"


# Rule 3400XX: experimental CSS rule
#SecRule REQUEST_URI "/(?:\x3C|<)(?:\x2F|\/)*[a-z0-9\%]+(?:\x3E|>)"

# Rule 340099: cross site scripting attempt IMG onerror or onload
SecRule REQUEST_URI "\<IMG.*/\bonerror\b[\s]*=" \
	"id:340099,rev:1,severity:2,msg:'cross site scripting attempt IMG onerror or onload'"


# Rule 340100: cross site scripting attempt TYPE + JAVASCRIPT
SecRule REQUEST_URI "TYPE\s*=\s*[\'\"]text\/javascript" \
	"id:340100,rev:1,severity:2,msg:'cross site scripting attempt TYPE + JAVASCRIPT'"


# Rule 340101: cross site scripting attempt STYLE + JAVASCRIPT
SecRule REQUEST_URI "TYPE\s*=\s*[\'\"]application\/x-javascript" \
	"id:340101,rev:1,severity:2,msg:'cross site scripting attempt STYLE + JAVASCRIPT'"


# Rule 340102: cross site scripting attempt STYLE + JSCRIPT
SecRule REQUEST_URI "TYPE\s*=\s*[\'\"]text\/jscript" \
	"id:340102,rev:1,severity:2,msg:'cross site scripting attempt STYLE + JSCRIPT'"


# Rule 340103: cross site scripting attempt STYLE + VBSCRIPT
SecRule REQUEST_URI "TYPE\s*=\s*[\'\"]text\/vbscript" \
	"id:340103,rev:1,severity:2,msg:'cross site scripting attempt STYLE + VBSCRIPT'"


# Rule 340104: cross site scripting attempt STYLE + VBSCRIPT
SecRule REQUEST_URI "TYPE\s*=\s*[\'\"]application\/x-vbscript" \
	"id:340104,rev:1,severity:2,msg:'cross site scripting attempt STYLE + VBSCRIPT'"



# Rule 340105: cross site scripting attempt STYLE + ECMACRIPT
SecRule REQUEST_URI "TYPE\s*=\s*[\'\"]text\/ecmascript" \
	"id:340105,rev:1,severity:2,msg:'cross site scripting attempt STYLE + ECMACRIPT'"


# Rule 340106: cross site scripting attempt STYLE + EXPRESSION
SecRule REQUEST_URI "STYLE[\s]*=[\s]*[^>]expression[\s]*\(" \
	"id:340106,rev:1,severity:2,msg:'cross site scripting attempt STYLE + EXPRESSION'"


# Rule 340107: cross site scripting attempt STYLE + EXPRESSION
SecRule REQUEST_URI "[\s]*expression[\s]*\([^}]}[\s]*<\/STYLE>" \
	"id:340107,rev:1,severity:2,msg:'cross site scripting attempt STYLE + EXPRESSION'"

# Rule 340108: There is no 340108.

# Rule 340109: cross site scripting attempt using XML
SecRule REQUEST_URI "<!\[CDATA\[<\]\]>SCRIPT" \
	"id:340109,rev:1,severity:2,msg:'cross site scripting attempt using XML'"


# Rule 340110: cross site scripting attempt executing hidden Javascript
SecRule REQUEST_URI "eval[\s]*\([\s]*[^\.]\.innerHTML[\s]*\)" \
	"id:340110,rev:1,severity:2,msg:'cross site scripting attempt executing hidden Javascript'"


# Rule 340111: cross site scripting attempt executing hidden Javascript
SecRule REQUEST_URI "window\.execScript[\s]*\(" \
	"id:340111,rev:1,severity:2,msg:'cross site scripting attempt executing hidden Javascript'"

# Rule 340112: cross site scripting attempt to execute Javascript code
SecRule REQUEST_URI "/(?:(?:(?:URL|SRC|HREF|LOWSRC)[\s]*=)|(?:url[\s]*[\(]))[\s]*[\'\"]*javascript[\:]" \
	"id:340112,rev:1,severity:2,msg:'cross site scripting attempt to execute Javascript code'"


# Rule 340113: cross site scripting stealth attempt to execute Javascript code
# may false alarm for some language sets
SecRule REQUEST_URI "!(?:/index\.php\?module=Blocks&type=admin&func=update|/index\.php\?go=.*&edit=)"\
	"chain,id:340113,rev:1,severity:2,msg:'cross site scripting stealth attempt to execute Javascript code'"
SecRule REQUEST_URI|REQUEST_BODY "(?:(?:(?:URL|SRC|HREF|LOWSRC)[\s]*=)|(?:url[\s]*[\(]))[\s]*[\'\"]*[\x09\x0a\x0b\x0c\x0d]*j[\x09\x0a\x0b\x0c\x0d]*a[\x09\x0a\x0b\x0c\x0d]*v[\x09\x0a\x0b\x0c\x0d]*a[\x09\x0a\x0b\x0c\x0d]*s[\x09\x0a\x0b\x0c\x0d]*c[\x09\x0a\x0b\x0c\x0d]*r[\x09\x0a\x0b\x0c\x0d]*i[\x09\x0a\x0b\x0c\x0d]*p[\x09\x0a\x0b\x0c\x0d]*t[\x09\x0a\x0b\x0c\x0d]*[\:]" \


# Rule 340114: Apache /server-info accessible
SecRule REQUEST_URI   "/server-info" \
	"chain,id:340114,rev:1,severity:2,msg:'/server-info access attempt'"
SecRule REMOTE_ADDR "!^127\.0\.0\.1$" 


# Rule 340115: Apache /server-status accessible
# Modified so apache-protect can run
SecRule REQUEST_URI "^/server-status/$" \
	"chain,id:340115,rev:1,severity:2,msg:'/server-status access attempt'"
SecRule REMOTE_ADDR "!^127\.0\.0\.1$" 


# Rule 340116: generic Common HTTP vulnerability
SecRule REQUEST_URI "/\?cwd=/" \
	"id:340116,rev:1,severity:2,msg:'Common HTTP vulnerability'"


# Rule 340117: General [url] php forum protections (phpbb and others, to protect against script injection attacks in url links)
SecRule REQUEST_URI "\.php\?" \
	"chain,id:340117,rev:1,severity:2,msg:'General [url] php forum protections'"
SecRule REQUEST_URI|REQUEST_BODY "\[url=(?:script|javascript|applet|about|chrome|activex)\:/.*\].*\[/url\]" 


# Rule 340118: Experimental XML-RPC generic attack sigs
SecRule REQUEST_BODY "\'\,\'\'\)\)\;" \
	"id:340118,rev:1,severity:2,msg:'Generic XML-RPC  attack'"

# Rule 340119: Generic XML-RPC generic attack sigs
SecRule REQUEST_BODY "\<param\>\<name\>.*\'\)\;" \
	"id:340119,rev:1,severity:2,msg:'Generic XML-RPC  attack'"

# Rule 340120: XML-RPC generic attack sigs
SecRule REQUEST_HEADERS "^Content-Type\: application/xml" \
	"chain,id:340120,rev:1,severity:2,msg:'Generic XML-RPC  attack'"
SecRule REQUEST_BODY "(?:\<xml|\<.*xml)" chain
SecRule REQUEST_BODY "(?:echo(?: |\(|\').*\;|chr|fwrite|fopen|system|echr|passthru|popen|proc_open|shell_exec|exec|proc_nice|proc_terminate|proc_get_status|proc_close|pfsockopen|leak|apache_child_terminate|posix_kill|posix_mkfifo|posix_setpgid|posix_setsid|posix_setuid|phpinfo)\(.*\)\;" chain
SecRule REQUEST_BODY "methodCall\>" 


# Rule 340121: Specific XML-RPC attacks on xmlrpc.php
SecRule REQUEST_URI "(?:xmlrpc|xmlrpc.*)\.php" \
	"chain,id:340121,rev:1,severity:2,msg:'XML-RPC attacks on xmlrpc.php'"
SecRule REQUEST_BODY "(?:\<xml|\<.*xml)" chain
SecRule REQUEST_BODY "(?:echo(?: |\(|\').*\;|chr|fwrite|fopen|system|echr|passthru|popen|proc_open|shell_exec|exec|proc_nice|proc_terminate|proc_get_status|proc_close|pfsockopen|leak|apache_child_terminate|posix_kill|posix_mkfifo|posix_setpgid|posix_setsid|posix_setuid|phpinfo)\(.*\)\;" 


# Rule 340XXX: 
#Too generic, unless you know you won't see this in any of the fields of an XMLRPC message on your system
#SecRule REQUEST_URI "/xmlrpc\.php" chain
#SecRule "(?:cd|perl |python |rpm |yum |apt-get |emerge |lynx |links |mkdir |elinks |cmd|pwd|wget |id|uname |cvs |svn |(?:s|r)(?:cp|sh) |rexec |smbclient |t?ftp |ncftp |curl |telnet |gcc |cc |g\+\+ |\./)"

# Rule 340122: XML-RPC SQL injection generic signature
SecRule REQUEST_URI "(?:xmlrpc|xmlrpc_.*)\.php" \
	"id:340122,rev:1,severity:2,msg:'XML-RPC SQL injection ',chain"
SecRule REQUEST_BODY  "<methodName>.*</methodName>.*<value><string>.*(?:select|grant|delete|insert|drop|do|alter|replace|truncate|update|create|rename|describe)[[:space:]]+[A-Z|a-z|0-9|\*| |,]+[[:space:]](?:from|into|table|database|index|view).*methodName\>" 


# Rule 340123: generic remote file inclusion vulns
SecRule REQUEST_URI "/index\.php\?do=.*&page=(?:ogg|gopger|zlib|(?:ht|f)tps?)\:/" \
	"id:340123,rev:1,severity:2,msg:'remote file inclusion attempt'"

# Rule 340124: Remote file inclusion attempt
SecRule REQUEST_URI "/index\.php\?kietu\[.*\]=(?:ogg|gopger|zlib|(?:ht|f)tps?)\:/" \
	"id:340124,rev:1,severity:2,msg:'Remote file inclusion attempt'"

# Rule 340125: Remote file inclusion attempt
##ZZZZ
SecRule REQUEST_URI "/index\.php\?libDir=:/" \
	"id:340125,rev:1,severity:2,msg:'Remote file inclusion attempt'"

# Rule 340126: Remote file inclusion attempt
SecRule REQUEST_URI "/init\.php\?HTTP_POST_VARS\[GALLERY_BASEDIR\]=(?:ogg|gopger|zlib|(?:ht|f)tps?)\:/" \
	"id:340126,rev:1,severity:2,msg:'Remote file inclusion attempt'"


# Rule 340XXX
#catch smuggling attacks
#SecRule "^(?:GET|POST).*Host:.*^(?:GET|POST)" 

# Rule 340127:  Drupal remote command execution vulnerability exploit signature
# This is already covered in another generic signature, but just in case you leave it out, here it is
# again with a slightly tigher regexp
SecRule REQUEST_BODY "\<.*php .*\(.*\)\;system\(.*\).*php*\>" \
	"id:340127,rev:1,severity:2,msg:'Remote command exection (system)'"

# Rule 340128: Slightly stronger version of the above
SecRule REQUEST_BODY "\<.*php .*\(.*\)\;(?:chr|fwrite|fopen|system|echr|passthru|popen|proc_open|shell_exec|exec|proc_nice|proc_terminate|proc_get_status|proc_close|pfsockopen|leak|apache_child_terminate|posix_kill|posix_mkfifo|posix_setpgid|posix_setsid|posix_setuid|phpinfo)\(.*\).*php*\>" \
	"id:340128,rev:1,severity:2,msg:'Remote command exection (generic)'"


# Rule 340129: Generic PHP attack sig
SecRule REQUEST_BODY|REQUEST_URI "system\(getenv\(HTTP_PHP\)\)" \
	"id:340129,rev:1,severity:2,msg:'Generic PHP attack sig'"

 
# Rule 340130: Generic Nessus request filter
SecRule REQUEST_URI "NessusTest*\.html" \
	"id:340130,rev:1,severity:2,msg:'Nessus Scan'"


# Rule 340131: Generic PHP payload command injection and upload vulnerabilities
SecRule REQUEST_BODY "<\?php" \
	"id:340131,rev:1,severity:2,msg:'Generic PHP payload command injection and upload vulnerabilities',chain"
SecRule REQUEST_BODY  "(?:(?:fputs|fread)\(.*\,.*\)\;|fsockopen\(gethostbyname|chr\(.*\)\.chr\(.*\)\.chr\(|(?:fclose|fgets)\(.*\)\;|(?:system|exec)\(.*\)\;)" chain
SecRule REQUEST_BODY "\<\?php" 

# Rule 340132: Generic XML RPC attack sig
SecRule REQUEST_BODY "\'(?:______BEGIN______|_____FIM_____)\'\;" \
	"id:340132,rev:1,severity:2,msg:'Generic XML RPC attack'"


# Rule 340133: HTTP header PHP code injection attacks
SecRule REQUEST_HEADERS:Client-Ip|REQUEST_HEADERS:User-Agent|REQUEST_HEADERS:Referer "(?:<\?php|<[[:space:]]?\?[[:space:]]?php|<\? php)" \
	"id:340133,rev:1,severity:2,msg:'HTTP header PHP code injection attack'"

# Rule 340134: wormsign
SecRule REQUEST_HEADERS "XXXXXXXXXXXXXXX\: \+\+\+\+\+\+\+\+\+\+\+\+\+" \
	"id:340134,rev:1,severity:2,msg:'Worm signature'"

# Rule 340135: THMC worm
SecRule REQUEST_BODY "THMC\.\$dbhost\.THMC\.\$dbname\.THMC\.\$dbuser\.THMC\.\$dbpasswd\.THMC" \
	"id:340135,rev:1,severity:2,msg:'THMC worm'"


# Rule 340136: phpbb wormsign
SecRule REQUEST_URI|REQUEST_BODY "echo _GHC/RST_" \
	"id:340136,rev:1,severity:2,msg:'PHPBB worm'"


# Rule 340137: Generic PHP avatar upload exploits
SecRule REQUEST_URI "\.php" \
	"id:340137,rev:1,severity:2,msg:'PHPBB avatar exploit',chain"
SecRule REQUEST_BODY "Content-Disposition\: form-data\; name=\"avatar\"\;" chain
SecRule REQUEST_BODY "\<\?php" chain
SecRule REQUEST_BODY "\?>" 


# Rule 340138: Fake image file shell attacvk
SecRule REQUEST_HEADERS:Content-Type "image/.*" \
	"id:340138,rev:2,severity:2,msg:'Fake image file shell attack',chain"
SecRule REQUEST_BODY "chr\(.*\)" 


# Rule 340140: bogus graphics file
SecRule REQUEST_HEADERS:Content-Disposition "\.(?:php|txt)" \
	"id:340140,rev:2,severity:2,msg:'Bogus graphics file',chain"
SecRule REQUEST_HEADERS:Content-Type "(?:image/gif|image/jpg|image/png|image/bmp)" \


# Rule 340141: wormsign
SecRule REQUEST_URI "Hacked.*by.*member.*of.*SCC" \
	"id:340141,rev:1,severity:2,msg:'SCC worm'"


# Rule 340142: Special account protection
SecRule REQUEST_URI "/~(?:root|ftp|bin|nobody|named|guest|logs|sshd)/" \
	"t:lowercase,t:replaceNulls,t:compressWhitespace,t:normalisePath,id:340142,rev:1,severity:2,msg:'Special account protection'"


# Rule 340143: Generic PHP fopen sig
SecRule REQUEST_URI|REQUEST_BODY "fp=fopen\(" \
	"id:340143,rev:1,severity:2,msg:'PHP fopen attack'"


# Rule 340144: Generic SQL sigs 
SecRule REQUEST_URI "!(?:(?:/wp-admin/post|privmsg|/ticket/admin|/misc|tiki-editpage|/post|/horde3?/imp/compose|/posting)\.php|/modules\.php\?op=modload&name=(?:Downloads|Submit_News)|/admin\.php\?module=NS\-AddStory\&op=|/index\.php\?name=PNphpBB2&file=posting&mode=reply.*|/phpMyAdmin/|/PNphpBB2-posting\.html|/otrs/index\.pl|tiki-index\.php\?page=|/index\.php\?title=.*&action=edit|/_mmServerScripts/|/node/[0-9]+/edit|/_vti_bin/.*\.exe/|/joomla/administrator/index2\.php|module=admin&act=dispLayoutAdminEdit&layout_srl=|upgrade.php?step=|^/ubbthreads/install/)" \
	"id:340144,rev:7,severity:2,msg:'Generic SQL injection protection 2',chain"
SecRule ARGS "(?:(?:alter|create|drop)[[:space:]]*(?:column|database|procedure|table)|delete[[:space:]]*update.+set.+=)" 

# Rule 340145: Generic SQL sigs
SecRule ARGS "(?:or.+1[[:space:]]*=[[:space:]]1|(?:or 1=1|'.+)--')" \
	"id:340145,rev:1,severity:2,msg:'Generic SQL injection protection'"

# Rule 340146: Meta character SQL injection
SecRule REQUEST_URI "\'.*(?:insert[[:space:]]+into.+values|select.*from.+[a-z|A-Z|0-9]|select.+from|bulk[[:space:]]+insert|union.+select|convert.+\(.*from)|and.*char\(.*\)" \
	 "id:340146,rev:1,severity:2,msg:'Generic SQL metacharacter URI injection protection'"

# Rule 340147: Generic XSS filter
SecRule REQUEST_URI "!/mt\.cgi" \
	"id:340147,rev:1,severity:2,msg:'Generic XSS filter',chain"
SecRule REQUEST_URI|REQUEST_BODY "<[[:space:]]*(?:script|about|applet|activex|chrome)*>.*(?:script|about|applet|activex|chrome)[[:space:]]*>" 

# Rule 340148: PHP Injection Attack generic signature
SecRule REQUEST_URI "!(?:/imp/compose|/editor|/tiki-objectpermissions|aardvarkts/install/index|/do_command|banner_click|wp-login|tiki-view_cache|/horde/index|/horde/services/go|/goto|gallery2?/main|ad-?server/adjs|calendar/index\.php\?act=calendar&code=edit&cal_id=.*&event_id=|^/go\.php\?u=affilorama&t=http://)"\
	 "id:340148,rev:11,severity:2,msg:'Generic PHP code injection protection in URI',chain"
SecRule REQUEST_HEADERS:Referer "!/imp/login\.php" chain
SecRule REQUEST_URI "\.php(?:3|4|5)?(?:\?|&).*=(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/"  chain
SecRule ARGS|!ARGS:url|!ARGS:base_url|!ARGS:serverurl|!ARGS:url2send|!ARGS:referrer|!ARGS:team[logo]|!ARGS:team[url]|!ARGS:helpurl|!ARGS:helpbox|!ARGS:website|!ARGS:return|!ARGS:ureferrer|!ARGS:refertoyouby|!ARGS:ajaxurl|!ARGS:redirect|!ARGS:backurl|!ARGS:oaparams "(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/" 

# Rule 340149:  PHP Remote path
#SecRule REQUEST_URI  "\.php.*path=(?:http|https|ftp)\:/" \
#	"id:340149,rev:2,severity:2,msg:'PHP Remote path attach',chain"

# Rule 340150:  Dfind signature
# w00tw00t.at.ISC.SANS.DFind
SecRule REQUEST_URI  "/w00tw00t\.at\.ISC\.SANS\.DFind" \
	"id:340150,rev:1,severity:2,msg:'DFind scanner attempt'"


#Rule 340152: PHP Injection attack
SecRule REQUEST_URI "!(?:^/newsletter/admin/\?page=spageedit|^\?q=node/add/page$|^\?q=(?:en|de)/node/[0-9]/edit$|^/(?:maillist|lists)/admin/\?page=(template|template&id=[0-9]+)$|^/leap/\?admin\.menus\.edit\.[0-9]+$)" \
	"t:normalisePath,id:340152,rev:23,severity:2,msg:'Generic PHP code injection protection via ARGS 2',chain"
SecRule REQUEST_URI "/+\?" chain 
#SecRule ARGS "!@pmFromFile trusted-domains.conf" chain
SecRule ARGS|!ARGS:return|!ARGS:url|!ARGS:base_url|!ARGS:outbound|!ARGS:out|!ARGS:message|!ARGS:serverurl|!ARGS:redirect_to|!ARGS:external_link|!ARGS:site_footer|!ARGS:body_html|!ARGS:referrer|!ARGS:team[logo]|!ARGS:team[url]|!ARGS:helpurl|!ARGS:helpbox|!ARGS:website|!ARGS:return|!ARGS:attach-url||!ARGS:url2send|!ARGS:ureferrer|!ARGS:comment|!ARGS:basehref|!ARGS:redirect|!ARGS:refertoyouby|!ARGS:ajaxurl|!ARGS:product[media_gallery][images]|!ARGS:loc|!ARGS:backurl|!ARGS:referer|!ARGS:resource "(?:ogg|gopher|zlib|(?:ht|f)tps?\:/)"


# Rule 340151: Generic PHP code injection protection in URI w/ anti-evasion
SecRule REQUEST_FILENAME|REQUEST_URI "!(?:^/signup\.php|^/go\.php\?u=affilorama&t=http://)" \
         "id:340151,t:normalisePath,t:replaceNulls,t:htmlEntityDecode,t:urlDecodeUni,t:compressWhiteSpace,t:lowercase,chain,rev:15,severity:2,msg:'PHP Injection attempt in URI'"
SecRule REQUEST_URI "(?:\.php(?:3|4|5)?(?:\?|&)|^/(?:\?|&)).*=(?:ogg|gopger|zlib|(?:ht|f)tps?)\:/" chain
SecRule REQUEST_URI "!(?:/imp/compose\.php|/tiki-(?:objectpermissions|editpage)|/cowadmin/editor/.*/editor|index\.php\?url=|aardvarkts/install/index|/do_command|banner_click|wp-login|tiki-view_cache|/horde/index|/horde/services/go|/goto|gallery2?/main|ad-?server/adjs|signup\.php|calendar/index\.php\?act=calendar&code=edit&cal_id=.*&event_id=|cgi-bin/stats\.cgi\?id=shop&loc=http)" chain
#SecRule ARGS "!@pmFromFile trusted-domains.conf" chain
SecRule ARGS|!ARGS:url|!ARGS:base_url|!ARGS:outbound|!ARGS:out|!ARGS:referer|!ARGS:serverurl|!ARGS:referrer|!ARGS:team[logo]|!ARGS:team[url]|!ARGS:helpurl|!ARGS:helpbox|!ARGS:website|!ARGS:return|!ARGS:url2send|!ARGS:attach-url|!ARGS:ureferrer|!ARGS:comment|!ARGS:basehref|!ARGS:redirect|!ARGS:refertoyouby|!ARGS:ajaxurl||!ARGS:product[media_gallery][images]|!ARGS:oaparams|!ARGS:loc|!ARGS:backurl "(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/" 

#Rule 340153: PHP Injection attack w/ antievasion
SecRule REQUEST_URI "!(?:^/newsletter/admin/\?page=spageedit|^\?q=node/add/page$|^\?q=(?:en|de)/node/[0-9]/edit$)" \
	"id:340153,t:normalisePath,t:replaceNulls,t:htmlEntityDecode,t:urlDecodeUni,t:compressWhiteSpace,t:lowercase,chain,rev:18,severity:2,msg:'Generic PHP code injection protection via ARGS 3'"
SecRule REQUEST_URI "/\?" chain 
#SecRule ARGS "!@pmFromFile trusted-domains.conf" chain
SecRule ARGS|!ARGS:return|!ARGS:url|!ARGS:base_url|!ARGS:outbound|!ARGS:out|!ARGS:message|!ARGS:serverurl|!ARGS:redirect_to|!ARGS:external_link|!ARGS:site_footer|!ARGS:body_html|!ARGS:referrer|!ARGS:team[logo]|!ARGS:team[url]|!ARGS:helpurl|!ARGS:helpbox|!ARGS:website|!ARGS:return|!ARGS:attach-url||!ARGS:url2send|!ARGS:ureferrer|!ARGS:redirect|!ARGS:refertoyouby|!ARGS:ajaxurl|!ARGS:product[media_gallery][images]|!ARGS:oaparams|!ARGS:loc|!ARGS:backurl|!ARGS:referer|!ARGS:resource "(?:ogg|gopher|zlib|(?:ht|f)tps?\:/)"


#Rule 340154: Enhanced XSS protection w/antievasion
#SecRule ARGS|ARGS_NAMES|REQUEST_FILNAME|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer "@pmFromFile xss.txt"  \
#	"t:htmlEntityDecode,t:urlDecodeUni,t:compressWhiteSpace,t:lowercase,chain,id:340154,rev:1,severity:2,msg:'Generic PHP code injection protection via ARGS 3'"


#Always SQL injection cases w/ antievasion
SecRule ARGS|ARGS_NAMES|REQUEST_FILENAME|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer|!REQUEST_COOKIES:utmctr "@pmFromFile sql.txt"  \
        "id:340155,t:urlDecodeUni,t:htmlEntityDecode,t:replaceComments,t:compressWhiteSpace,t:lowercase,rev:3,severity:2,msg:'Generic SQL Injection protection'"

#Always bad SQL injection case w/ antievasion
SecRule ARGS|ARGS_NAMES|REQUEST_FILENAME|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer|!REQUEST_HEADERS:Cookie|!ARGS:topicseen|!ARGS_NAMES:posted_data[product_substring] "\b(\d+) ?= ?\1\b|[\'\"](\w+)[\'\"] ?= ?[\'\"]\2\b" \
	"id:340156,capture,t:htmlEntityDecode,t:replaceComments,t:compressWhiteSpace,t:lowercase,rev:7,severity:2,msg:'Generic SQL injection protection'"

#SQL inline command attack
SecRule REQUEST_URI "!(?:/ubbthreads/ubbthreads\.php|/phpBB3/install/index\.php|/index\.php\?mode=install&sub=create_table$)" \
	"id:340157,t:replaceNulls,t:htmlEntityDecode,t:urlDecodeUni,t:compressWhiteSpace,t:lowercase,t:replaceComments,rev:11,severity:2,msg:'Generic SQL inline command protection',chain"
SecRule REQUEST_URI|ARGS|!ARGS:form[pagina_text]|!ARGS:description|!ARGS:message "(?:(\w+)and(\w+)char\([0-9]+\)|(?:execute|convert)\(|(?:\;delete.*;(?:insert|declare|varchar)|(?:and .* \(select |(?:drop|create)(\w+)table|declare .* varchar\())|convert\(varchar|null,(?:null,(?:null|accesslevel|user_name),|concat\()|union select )"

# Rule 340158: 
#XSS in referrer 
SecRule REQUEST_HEADERS:REFERER|REQUEST_URI "!(?:/plugins/editors/tinymce/jscripts/|/modules/tinymce/tinymce/jscripts|/phpinfo_iframe\.php)" \
	"id:340158,t:replaceNulls,t:htmlEntityDecode,t:urlDecodeUni,t:compressWhiteSpace,t:lowercase,rev:5,severity:2,msg:'XSS in referrer',chain"
SecRule REQUEST_HEADERS:REFERER "!(^pagead[0-9]\.googlesyndication\.com/pagead/)" chain
SecRule REQUEST_HEADERS:REFERER "(?:\'(?:ogg|gopher|zlib|(?:ht|f)tps?)\:/|<[[:space:]]*(?:script|about|applet|activex|chrome)*>.*(?:script|about|applet|activex|chrome)[[:space:]]*>|activexobject|(?:\.add|\@)import|asfunction\:|background-image\:|e(?:cma|exec)script|\.fromcharcode|get(?:parentfolder|specialfolder)|iframe |\.innerhtml|<input|(?:java|live|j)script!s|lowsrc|mocha\:|on(?:abort|blur|change|click|dragdrop|focus|keydown|move|resize|select|submit|unload|key(?:press|up)|load)|onmouse(?:down|move|out|over|up)|script |settimeout|shell:|(?:vb|x-java)script)" \

#SQL inline command attack with more AE cases
SecRule REQUEST_URI "!(/ubbthreads/ubbthreads\.php|/install/index\.php\?mode=install&sub=create_table)" \
                "id:340159,t:base64Decode,t:hexDecode,t:replaceNulls,t:htmlEntityDecode,t:urlDecodeUni,t:compressWhiteSpace,t:lowercase,t:replaceComments,rev:3,severity:2,msg:'Generic SQL inline command protection (MM)',chain"
SecRule REQUEST_URI|ARGS|!ARGS:form[pagina_text]|!ARGS:description|!ARGS:message "(?:(\w+)and(\w+)char\([0-9]+\)|(?:execute|convert)\(|(?:\;delete.*;(?:insert|declare|varchar)|(?:and .* \(select |(?:drop|create)(\w+)table|declare .* varchar\())|convert\(varchar|null,(?:null,(?:null|accesslevel|user_name),|concat\()|union select )" multiMatch

#Always SQL injection cases w/ antievasion
SecRule ARGS|ARGS_NAMES|REQUEST_FILENAME|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer "@pmFromFile sql.txt" \
        "id:340160,t:base64Decode,t:hexDecode,t:urlDecodeUni,t:htmlEntityDecode,t:replaceComments,t:compressWhiteSpace,t:lowercase,rev:2,severity:2,msg:'Generic SQL Injection protection',multimatch"
